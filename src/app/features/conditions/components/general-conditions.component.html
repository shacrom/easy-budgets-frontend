<div class="general-conditions-container">
  <div class="header">
    <input
      type="text"
      [value]="title()"
      (input)="updateTitle($event)"
      class="header-title-editable"
      placeholder="CONDICIONES GENERALES">
    <div class="header-actions">
      @if (hasUnsavedChanges()) {
        <span class="unsaved-indicator">
          <span class="material-symbols-rounded" aria-hidden="true">edit_note</span>
          <span>Cambios sin guardar</span>
        </span>
      }
      @if (hasUnsavedChanges()) {
        <button
          type="button"
          class="btn ghost"
          (click)="discardChanges()"
          [disabled]="isSaving()">
          <span class="material-symbols-rounded" aria-hidden="true">close</span>
          <span>Cancelar</span>
        </button>
      }
      <button
        type="button"
        [class]="hasUnsavedChanges() ? 'btn solid' : 'btn ghost'"
        (click)="saveChanges()"
        [disabled]="isSaving() || !hasUnsavedChanges()">
        <span class="material-symbols-rounded" aria-hidden="true">save</span>
        <span>{{ isSaving() ? 'Guardando...' : 'Guardar cambios' }}</span>
      </button>
      <button
        (click)="addCondition()"
        class="btn-add-condition"
        type="button">
        + Añadir Condición
      </button>
    </div>
  </div>

  <div class="template-selector-container">
    <div class="template-controls">
      <div class="select-wrapper">
        <label for="template-select" class="template-label">
          Seleccionar Plantilla:
        </label>
        <select
          id="template-select"
          [value]="selectedTemplateId()"
          (change)="changeTemplate($event)"
          class="template-select">
          <option [value]="null">-- Seleccionar --</option>
          @for (template of templates(); track template.id) {
            <option [value]="template.id">{{ template.name }}</option>
          }
        </select>
      </div>

      <button
        type="button"
        class="btn ghost btn-sm"
        (click)="toggleCreateTemplate()">
        <span class="material-symbols-rounded">save_as</span>
        Guardar como plantilla
      </button>

      @if (selectedTemplateId()) {
        <button
          type="button"
          class="btn ghost btn-sm btn-danger"
          (click)="deleteTemplate()"
          title="Eliminar plantilla seleccionada">
          <span class="material-symbols-rounded">delete</span>
        </button>
      }
    </div>

    @if (isCreatingTemplate()) {
      <div class="create-template-form">
        <input
          type="text"
          [value]="newTemplateName()"
          (input)="updateNewTemplateName($event)"
          placeholder="Nombre de la nueva plantilla"
          class="input-field template-name-input">
        <div class="template-form-actions">
          <button
            type="button"
            class="btn solid btn-sm"
            (click)="saveTemplate()"
            [disabled]="!newTemplateName() || isSaving()">
            Guardar
          </button>
          <button
            type="button"
            class="btn ghost btn-sm"
            (click)="toggleCreateTemplate()">
            Cancelar
          </button>
        </div>
      </div>
    }

    <p class="template-hint">
      Cambia la plantilla para cargar condiciones específicas de cada proveedor
    </p>
  </div>

  <div class="conditions-card">
    <!-- Edit view -->
    <div class="conditions-edit-view">
      @for (condition of conditions(); track condition.id; let idx = $index) {
        <div class="condition-edit-item">
          <div class="condition-number-badge">CONDICIÓN {{ idx + 1 }}</div>

          <div class="condition-header-row">
            <div class="condition-title-group">
              <label class="form-label">TÍTULO:</label>
              <input
                type="text"
                [value]="condition.title"
                (input)="updateConditionField(condition.id, 'title', $event)"
                class="title-input-block"
                placeholder="TÍTULO DE LA CONDICIÓN">
            </div>
            
            <button
              (click)="deleteCondition(condition.id)"
              class="btn-icon-delete"
              type="button"
              title="Eliminar condición">
              <span class="material-symbols-rounded">delete</span>
            </button>
          </div>

          <div class="condition-content">
            <label class="form-label">TEXTO:</label>
            <textarea
              [value]="condition.text"
              (input)="updateConditionField(condition.id, 'text', $event)"
              rows="3"
              class="textarea-field-block"
              placeholder="Descripción detallada de la condición..."></textarea>
          </div>
        </div>
      }

      @if (conditions().length === 0) {
        <div class="empty-state">
          <p class="text-gray-500 text-center">
            No hay condiciones añadidas. Haz clic en "Añadir Condición" para comenzar.
          </p>
        </div>
      }
    </div>
  </div>
</div>

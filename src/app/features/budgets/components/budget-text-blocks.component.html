<div class="budget-text-blocks-container">
  <div class="header">
    <h2 class="text-2xl font-light text-gray-900 uppercase" style="letter-spacing: 0.15em;">Bloques de Texto</h2>
    <div class="header-actions">
      @if (hasUnsavedChanges()) {
        <span class="unsaved-indicator">Cambios sin guardar</span>
      }
      <button
        type="button"
        (click)="saveChanges()"
        [disabled]="!hasUnsavedChanges() || isSaving()"
        [class]="hasUnsavedChanges() ? 'btn solid' : 'btn ghost'"
        class="save-btn">
        <span class="material-symbols-rounded">save</span>
        {{ isSaving() ? 'Guardando...' : 'Guardar cambios' }}
      </button>
      <button
        (click)="addNewBlock()"
        class="btn-add-block"
        type="button"
        [disabled]="isCreating()">
        @if (isCreating()) {
          <span>Creando...</span>
        } @else {
          <span>Añadir Bloque</span>
        }
      </button>
    </div>
  </div>

  <div class="blocks-list">
    @if (isLoading()) {
      <div class="loading-state">
        <p class="text-gray-500 text-center">Cargando bloques...</p>
      </div>
    } @else if (blocks().length === 0) {
      <div class="empty-state">
        <p class="text-gray-500 text-center">
          No hay bloques añadidos. Haz clic en "Añadir Bloque" para empezar.
        </p>
      </div>
    } @else {
      @for (block of blocks(); track block.id) {
        <app-budget-text-block
          [block]="block"
          (blockUpdated)="updateBlock($event)"
          (blockDeleted)="deleteBlock($event)">
        </app-budget-text-block>
      }
    }
  </div>

  @if (blocks().length > 0) {
    <div class="total-section">
      <div class="total-label">Total General:</div>
      <div class="total-amount">
        {{ grandTotal() | currency:'EUR':'symbol':'1.2-2':'es' }}
      </div>
    </div>
  }
</div>

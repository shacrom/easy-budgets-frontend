<!-- Edit view permanente -->
<tr class="material-row edit-mode" [class.dropdown-active]="referenceDropdownOpen()">
    <td class="material-cell reference">
        <input
          type="text"
          [value]="localReference()"
          (input)="onReferenceChange($any($event.target).value)"
          (focus)="openReferenceDropdown()"
          (blur)="closeReferenceDropdown()"
          autocomplete="off"
          class="input-field"
          placeholder="Buscar referencia">
        @if (referenceDropdownOpen()) {
          <div class="reference-dropdown" role="listbox">
            @if (products().length === 0) {
              <p class="reference-empty">Catálogo no disponible</p>
            } @else if (referenceMatches().length === 0) {
              <p class="reference-empty">Sin coincidencias</p>
            } @else {
              <div class="reference-list">
                @for (product of referenceMatches(); track product.id ?? product.reference) {
                  <button type="button" class="reference-suggestion" (mousedown)="applyProductFromSuggestion($event, product)" role="option">
                    <span class="suggestion-reference">{{ product.reference }}</span>
                    <span class="suggestion-description">{{ product.description }}</span>
                  </button>
                }
              </div>
            }
          </div>
        }
    </td>
    <td class="material-cell description">
      <textarea
        #descTextarea
        rows="2"
        [value]="localDescription()"
        (input)="onDescriptionInput($event)"
        (focus)="resizeDescriptionTextarea()"
        class="input-field textarea-field"
        placeholder="Descripción del material"></textarea>
    </td>
    <td class="material-cell manufacturer">
      <input type="text" [value]="localManufacturer()" (input)="onManufacturerChange($any($event.target).value)" class="input-field">
    </td>
    <td class="material-cell quantity">
      <input type="number" [value]="localQuantity()" (input)="onQuantityChange($any($event.target).valueAsNumber)" min="0" class="input-field text-right" placeholder="0">
    </td>
    <td class="material-cell price">
      <input type="number" [value]="localUnitPrice()" (input)="onUnitPriceChange($any($event.target).valueAsNumber)" min="0" step="0.01" class="input-field text-right" placeholder="0.00">
    </td>
    <td class="material-cell price-total">
      <span class="font-normal">{{ totalPrice() | currency:'EUR':'symbol':'1.2-2':'es' }}</span>
    </td>
    <td class="material-cell actions">
      <button (click)="requestDelete()" class="btn-delete-row no-bg" type="button" title="Eliminar material">
      <span class="material-symbols-rounded" aria-hidden="true">delete</span>
      </button>
    </td>
</tr>

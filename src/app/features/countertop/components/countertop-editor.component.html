<div class="countertop-container">
  <div class="header">
    <h2>Encimera</h2>
  </div>

  <div class="content">
    <div class="form-group">
      <label>Modelo Encimera</label>
      <input
        type="text"
        [ngModel]="countertop().model"
        (ngModelChange)="updateModel($event)"
        (blur)="save()"
        placeholder="Ej: PETRA CREMA ABUJARDADO"
        class="form-input">
    </div>

    <div class="form-group">
      <label>Descripción y Medidas</label>
      <textarea
        [ngModel]="countertop().description"
        (ngModelChange)="updateDescription($event)"
        (blur)="save()"
        placeholder="Ej: Encimera de 12mm de espesor. Medidas: 200cm x 60cm"
        rows="3"
        class="form-textarea"></textarea>
    </div>

    <div class="image-section">
      <input
        #countertopFileInput
        type="file"
        class="sr-only"
        accept="image/*"
        (change)="onImageFileSelected($event)">

      <div class="image-placeholder" *ngIf="!countertop().imageUrl">
        <span>FOTO ENCIMERA</span>
        <div class="url-input-group">
          <input #urlInput
                 type="text"
                 placeholder="URL de la imagen"
                 (keydown.enter)="setImageUrl(urlInput.value)"
                 class="url-input">
          <button type="button"
                  (click)="setImageUrl(urlInput.value)"
                  class="add-image-btn"
                  title="Añadir imagen">
            <span class="material-symbols-rounded">add_photo_alternate</span>
          </button>
        </div>
        <button
          type="button"
          class="upload-image-btn mt-2"
          (click)="countertopFileInput.click()"
          [disabled]="isUploadingImage()">
          <span class="material-symbols-rounded" aria-hidden="true">file_upload</span>
          {{ isUploadingImage() ? 'Subiendo...' : 'Subir imagen desde archivo' }}
        </button>
      </div>

      <div *ngIf="countertop().imageUrl" class="image-preview-container">
        <img [src]="countertop().imageUrl" alt="Encimera" class="preview-image">
        <div class="image-preview-actions">
          <button
            type="button"
            class="upload-image-btn"
            (click)="countertopFileInput.click()"
            [disabled]="isUploadingImage()">
            <span class="material-symbols-rounded" aria-hidden="true">file_upload</span>
            {{ isUploadingImage() ? 'Subiendo...' : 'Cambiar imagen' }}
          </button>
          <button type="button" (click)="clearImageUrl()" class="remove-image-btn">Quitar imagen</button>
        </div>
      </div>

      @if (imageUploadError()) {
        <p class="upload-error">{{ imageUploadError() }}</p>
      }
    </div>

    <div class="price-section">
      <label>Total Precio</label>
      <input
        type="number"
        [ngModel]="countertop().price"
        (ngModelChange)="updatePrice($event)"
        (blur)="save()"
        class="price-input">
      <span class="currency">€</span>
    </div>
  </div>
</div>
